<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to outbreaker2 • outbreaker2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">outbreaker2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="introduction_files/htmlwidgets-0.8/htmlwidgets.js"></script><link href="introduction_files/vis-4.17.0/vis.css" rel="stylesheet">
<script src="introduction_files/vis-4.17.0/vis.min.js"></script><script src="introduction_files/visNetwork-binding-1.0.3/visNetwork.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to outbreaker2</h1>
                        <h4 class="author">Thibaut Jombart</h4>
            
            <h4 class="date">2017-02-03</h4>
          </div>

    
    
<div class="contents">
<p>This tutorial provides a worked example of outbreak reconstruction using <em>outbreaker2</em>. For installation guidelines, a general overview of the package’s functionalities as well as other resources, see the ‘overview’ vignette:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"Overview"</span>, <span class="dt">package =</span> <span class="st">"outbreaker2"</span>)</code></pre></div>
<p>We will be analysing a small simulated outbreak distributed with the package, <code>fake_outbreak</code>. This dataset contains simulated dates of onsets and pathogen genome sequences for 30 cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ape)
<span class="kw">library</span>(outbreaker2)

col &lt;-<span class="st"> "#6666cc"</span>
fake_outbreak
<span class="co">#&gt; $onset</span>
<span class="co">#&gt;  [1]  0  2  4  4  6  6  6  7  7  8  8  8  8  9  9  9  9 10 10 10 10 10 10</span>
<span class="co">#&gt; [24] 10 10 10 10 10 11 11</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sample</span>
<span class="co">#&gt;  [1]  3  5  6  6  7  9  8  9  9  9 11 10 10 10 10 11 11 12 11 13 12 13 11</span>
<span class="co">#&gt; [24] 12 11 11 13 12 14 14</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dna</span>
<span class="co">#&gt; 30 DNA sequences in binary format stored in a matrix.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; All sequences of same length: 10000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:  ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Base composition:</span>
<span class="co">#&gt;     a     c     g     t </span>
<span class="co">#&gt; 0.251 0.242 0.251 0.256 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $w</span>
<span class="co">#&gt; [1] 0.10 0.50 1.00 0.75</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ances</span>
<span class="co">#&gt;  [1] NA  1  2 NA  3  4  4  5  6  6  7  8  9  5  5  7  7  8  9 10 11 11 13</span>
<span class="co">#&gt; [24] 13 13 17 17 NA 10 13</span></code></pre></div>
<p>Here, we will use the dates of case isolation <code>$sample</code>, DNA sequences <code>$dna</code>, and the empirical distribution of the generation time <code>$w</code>, which can be visualised as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(fake_outbreak$w, <span class="dt">type =</span> <span class="st">"h"</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), 
     <span class="dt">lwd =</span> <span class="dv">30</span>, <span class="dt">col =</span> col, <span class="dt">lend =</span> <span class="dv">2</span>, 
     <span class="dt">xlab =</span> <span class="st">"Days after infection"</span>, 
     <span class="dt">ylab =</span> <span class="st">"p(new case)"</span>, 
     <span class="dt">main =</span> <span class="st">"Generation time distribution"</span>)</code></pre></div>
<p><img src="figs-introduction/w-1.png" width="768"></p>
<p><br></p>
<div id="running-the-analysis-with-defaults" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#running-the-analysis-with-defaults" class="anchor"> </a></body></html>Running the analysis with defaults</h1>
<p>By default, <em>outbreaker2</em> uses the settings defined by <code><a href="../reference/create_config.html">create_config()</a></code>; see the documentation of this function for details. Note that the main function of <em>outbreaker2</em> is called <code>outbreaker</code> (without number). The function’s arguments are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(outbreaker)
<span class="co">#&gt; function (data = outbreaker_data(), config = create_config(), </span>
<span class="co">#&gt;     priors = custom_priors(), likelihoods = custom_likelihoods(), </span>
<span class="co">#&gt;     moves = custom_moves()) </span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>The only mandatory input really is the data. For most cases, customising the method will be done through <code>config</code> and the function <code><a href="../reference/create_config.html">create_config()</a></code>, which creates default and alters settings such as prior parameters, length and rate of sampling from the MCMC, and definition of which parameters should be estimated (‘moved’). The last arguments of <code>outbreaker</code> are used to specify custom prior, likelihood, and movement functions, and are detailed in the ‘<em>Customisation</em>’ vignette.</p>
<p>Let us run the analysis with default settings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
dna &lt;-<span class="st"> </span>fake_outbreak$dna
dates &lt;-<span class="st"> </span>fake_outbreak$sample
w &lt;-<span class="st"> </span>fake_outbreak$w
data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/outbreaker_data.html">outbreaker_data</a></span>(<span class="dt">dna =</span> dna, <span class="dt">dates =</span> dates, <span class="dt">w_dens =</span> w)

## we set the seed to ensure results won't change
<span class="kw">set.seed</span>(<span class="dv">1</span>)


res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/outbreaker.html">outbreaker</a></span>(<span class="dt">data =</span> data)</code></pre></div>
<p>This analysis will take around 40 seconds on a modern computer. Note that <em>outbreaker2</em> is slower than <em>outbreaker</em> for the same number of iterations, but the two implementations are actually different. In particular, <em>outbreaker2</em> performs many more moves than the original package for each iteration of the MCMC, resulting in more efficient mixing. In short: <em>outbreaker2</em> is slower, but it requires far less iterations.</p>
<p>Results are stored in a <code>data.frame</code> with the special class <code>outbreaker_chains</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">class</span>(res)
<span class="co">#&gt; [1] "outbreaker_chains" "data.frame"</span>
<span class="kw">dim</span>(res)
<span class="co">#&gt; [1] 201  98</span>
res
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  ///// outbreaker results ///</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; class:  outbreaker_chains data.frame</span>
<span class="co">#&gt; dimensions 201 rows,  98 columns</span>
<span class="co">#&gt; ancestries not shown: alpha.1 - alpha.30</span>
<span class="co">#&gt; infection dates not shown: t_inf.1 - t_inf.30</span>
<span class="co">#&gt; intermediate generations not shown: kappa.1 - kappa.30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; /// head //</span>
<span class="co">#&gt;   step       post       like    prior           mu        pi eps lambda</span>
<span class="co">#&gt; 1    1 -1107.0523 -1115.2144 8.162096 1.000000e-04 0.9000000 0.5   0.05</span>
<span class="co">#&gt; 2   50  -647.9528  -651.3690 3.416238 5.150148e-05 0.5283128 0.5   0.05</span>
<span class="co">#&gt; 3  100  -643.1737  -644.5943 1.420567 4.961035e-05 0.4231544 0.5   0.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ...</span>
<span class="co">#&gt; /// tail //</span>
<span class="co">#&gt;      step      post      like    prior           mu        pi eps lambda</span>
<span class="co">#&gt; 199  9900 -558.0773 -564.1382 6.060963 7.321199e-05 0.7104930 0.5   0.05</span>
<span class="co">#&gt; 200  9950 -604.7960 -607.2165 2.420467 6.082569e-05 0.4734675 0.5   0.05</span>
<span class="co">#&gt; 201 10000 -543.9164 -549.2541 5.337745 1.019768e-04 0.6577321 0.5   0.05</span></code></pre></div>
<p>Each row of <code>res</code> contains a sample from the MCMC. For each, informations about the step (iteration of the MCMC), log-values of posterior, likelihood and priors, and all parameters and augmented data are returned. Ancestries (i.e. indices of the most recent ancestral case for a given case), are indicated by <code>alpha.[index of the case]</code>, dates of infections by <code>t_inf.[index of the case]</code>, and number of generations between cases and their infector / ancestor by <code>kappa.[index of the case]</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">names</span>(res)
<span class="co">#&gt;  [1] "step"     "post"     "like"     "prior"    "mu"       "pi"      </span>
<span class="co">#&gt;  [7] "eps"      "lambda"   "alpha.1"  "alpha.2"  "alpha.3"  "alpha.4" </span>
<span class="co">#&gt; [13] "alpha.5"  "alpha.6"  "alpha.7"  "alpha.8"  "alpha.9"  "alpha.10"</span>
<span class="co">#&gt; [19] "alpha.11" "alpha.12" "alpha.13" "alpha.14" "alpha.15" "alpha.16"</span>
<span class="co">#&gt; [25] "alpha.17" "alpha.18" "alpha.19" "alpha.20" "alpha.21" "alpha.22"</span>
<span class="co">#&gt; [31] "alpha.23" "alpha.24" "alpha.25" "alpha.26" "alpha.27" "alpha.28"</span>
<span class="co">#&gt; [37] "alpha.29" "alpha.30" "t_inf.1"  "t_inf.2"  "t_inf.3"  "t_inf.4" </span>
<span class="co">#&gt; [43] "t_inf.5"  "t_inf.6"  "t_inf.7"  "t_inf.8"  "t_inf.9"  "t_inf.10"</span>
<span class="co">#&gt; [49] "t_inf.11" "t_inf.12" "t_inf.13" "t_inf.14" "t_inf.15" "t_inf.16"</span>
<span class="co">#&gt; [55] "t_inf.17" "t_inf.18" "t_inf.19" "t_inf.20" "t_inf.21" "t_inf.22"</span>
<span class="co">#&gt; [61] "t_inf.23" "t_inf.24" "t_inf.25" "t_inf.26" "t_inf.27" "t_inf.28"</span>
<span class="co">#&gt; [67] "t_inf.29" "t_inf.30" "kappa.1"  "kappa.2"  "kappa.3"  "kappa.4" </span>
<span class="co">#&gt; [73] "kappa.5"  "kappa.6"  "kappa.7"  "kappa.8"  "kappa.9"  "kappa.10"</span>
<span class="co">#&gt; [79] "kappa.11" "kappa.12" "kappa.13" "kappa.14" "kappa.15" "kappa.16"</span>
<span class="co">#&gt; [85] "kappa.17" "kappa.18" "kappa.19" "kappa.20" "kappa.21" "kappa.22"</span>
<span class="co">#&gt; [91] "kappa.23" "kappa.24" "kappa.25" "kappa.26" "kappa.27" "kappa.28"</span>
<span class="co">#&gt; [97] "kappa.29" "kappa.30"</span></code></pre></div>
<p><br></p>
</div>
<div id="analysing-the-results" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#analysing-the-results" class="anchor"> </a></body></html>Analysing the results</h1>
<div id="graphics" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#graphics" class="anchor"> </a></body></html>Graphics</h2>
<p>Results can be visualised using <code>plot</code>, which has several options and can be used to derive various kinds of graphics (see <code><a href="../reference/print.outbreaker_chains.html">?plot.outbreaker_chains</a></code>). The basic plot shows the trace of the log-posterior values, which is useful to assess mixing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res)</code></pre></div>
<p><img src="figs-introduction/basic_trace-1.png" width="768"></p>
<p>The second argument of <code>plot</code> can be used to visualise traces of any other column in <code>res</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="st">"prior"</span>)</code></pre></div>
<p><img src="figs-introduction/traces-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res, <span class="st">"mu"</span>)</code></pre></div>
<p><img src="figs-introduction/traces-2.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res, <span class="st">"mu"</span>)</code></pre></div>
<p><img src="figs-introduction/traces-3.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res, <span class="st">"t_inf.15"</span>)</code></pre></div>
<p><img src="figs-introduction/traces-4.png" width="768"></p>
<p><code>burnin</code> can be used to discard the first iterations prior to mixing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
## compare this to plot(res)
<span class="kw">plot</span>(res, <span class="dt">burnin =</span> <span class="dv">2000</span>)</code></pre></div>
<p><img src="figs-introduction/basic_trace_burn-1.png" width="768"></p>
<p><code>type</code> indicates the type of graphic to plot; roughly:</p>
<ul>
<li><p><code>trace</code> for traces of the MCMC (default)</p></li>
<li><p><code>hist</code>, <code>density</code> to assess distributions of quantitative values</p></li>
<li><p><code>alpha</code>, <code>network</code> to visualise ancestries / transmission tree; note that <code>network</code> opens up an interactive plot and requires a web browser with Javascript enabled; the argument <code>min_support</code> is useful to select only the most supported ancestries and avoid displaying too many links</p></li>
<li><p><code>kappa</code> to visualise the distributions generations between cases and their ancestor / infector</p></li>
</ul>
<p>Here are a few examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="st">"mu"</span>, <span class="st">"hist"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>)
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="figs-introduction/many_plots-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="st">"mu"</span>, <span class="st">"density"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>)</code></pre></div>
<p><img src="figs-introduction/many_plots-2.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="dt">type =</span> <span class="st">"alpha"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>)
<span class="co">#&gt; Warning: Removed 480 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="figs-introduction/many_plots-3.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="dt">type =</span> <span class="st">"t_inf"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>)</code></pre></div>
<p><img src="figs-introduction/many_plots-4.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="dt">type =</span> <span class="st">"kappa"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>)
<span class="co">#&gt; Warning: Removed 480 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="figs-introduction/many_plots-5.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res, <span class="dt">type =</span> <span class="st">"network"</span>, <span class="dt">burnin =</span> <span class="dv">2000</span>, <span class="dt">min_support =</span> <span class="fl">0.01</span>)</code></pre></div>
<div id="htmlwidget-0926d07f4de66095a428" style="width:768px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-0926d07f4de66095a428">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"label":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"value":[1.00625,1,1.0125,4.13125,4.14375,2,0.8875,0.625,1.99375,1.99375,1.95,0.2125,4,0,0,0,1.91875,0,0,0,0,0.05,0,0.00625,0,0.0625,0,0,0.00625,0],"color":["#CCDDFF","#B2D9E3","#98D6C7","#7ED2AC","#99CAA9","#C2C0AD","#ECB7B1","#EFB0B5","#D3ABB9","#B6A7BE","#ADA8AD","#C9B471","#E5C035","#FFCA04","#FFBC2C","#FFAE53","#FFA07B","#F0B986","#E1D78E","#D1F596","#CFEBA0","#D5CDAC","#DBAFB8","#E3A5B9","#EDB3AD","#F7C1A2","#FBCC9C","#ECCCAC","#DCCCBC","#CDCDCD"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"shaped":["star",null,null,"star",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"star",null,null]},"edges":{"from":[1,2,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,6,6,7,7,7,8,8,8,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,17,17,22,22,26,26],"to":[2,3,5,8,18,6,7,11,16,17,22,26,8,12,14,15,18,9,10,11,16,17,5,12,14,15,18,13,19,20,29,21,22,8,14,15,18,23,24,25,30,26,27,11,21,17,27],"value":[1,0.99375,0.9625,0.03125,0.0125,0.99375,1,0.675,0.55625,0.84375,0.0125,0.04375,0.95,0.86875,0.84375,0.85,0.63125,1,1,0.3125,0.44375,0.11875,0.03125,0.13125,0.11875,0.13125,0.2125,1,0.99375,0.99375,1,0.9625,0.9875,0.01875,0.03125,0.01875,0.14375,1,1,1,0.99375,0.95,0.96875,0.0125,0.0375,0.0375,0.025],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"],"color":["#CCDDFF","#B2D9E3","#98D6C7","#98D6C7","#98D6C7","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#99CAA9","#99CAA9","#99CAA9","#99CAA9","#99CAA9","#C2C0AD","#C2C0AD","#ECB7B1","#ECB7B1","#ECB7B1","#EFB0B5","#EFB0B5","#EFB0B5","#EFB0B5","#EFB0B5","#D3ABB9","#D3ABB9","#B6A7BE","#B6A7BE","#ADA8AD","#ADA8AD","#C9B471","#C9B471","#C9B471","#C9B471","#E5C035","#E5C035","#E5C035","#E5C035","#FFA07B","#FFA07B","#D5CDAC","#D5CDAC","#F7C1A2","#F7C1A2"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","color":{"highlight":"red"},"shadow":{"enabled":true,"size":10}},"manipulation":{"enabled":false},"edges":{"arrows":{"to":{"enabled":true,"scaleFactor":0.2}},"color":{"highlight":"red"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null},"evals":[],"jsHooks":[]}</script>
</div>
<div id="using-summary" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#using-summary" class="anchor"> </a></body></html>Using <code>summary</code>
</h2>
<p>The summary of results derives various distributional statistics for posterior, likelihood and prior densities, as well as for the quantitative parameters. It also builds a consensus tree, by finding for each case the most frequent infector / ancestor in the posterior samples. The corresponding frequencies are reported as ‘support’. The most frequent value of kappa is also reported as ‘generations’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">summary</span>(res)
<span class="co">#&gt; $step</span>
<span class="co">#&gt;    first     last interval  n_steps </span>
<span class="co">#&gt;        1    10000       50      201 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $post</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt; -1107.0  -606.0  -585.9  -587.0  -567.5  -428.0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $like</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt; -1115.0  -608.6  -588.7  -590.2  -571.1  -436.9 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $prior</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  -0.698   2.174   3.242   3.216   4.037   8.985 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mu</span>
<span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span>
<span class="co">#&gt; 3.188e-05 5.307e-05 6.276e-05 6.280e-05 7.057e-05 1.404e-04 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pi</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  0.3352  0.4606  0.5183  0.5249  0.5671  0.9906 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tree</span>
<span class="co">#&gt;    from to time   support generations</span>
<span class="co">#&gt; 1    NA  1   -1        NA          NA</span>
<span class="co">#&gt; 2     1  2    1 1.0000000           1</span>
<span class="co">#&gt; 3     2  3    2 0.9950249           1</span>
<span class="co">#&gt; 4    NA  4    2        NA          NA</span>
<span class="co">#&gt; 5     3  5    4 0.9651741           1</span>
<span class="co">#&gt; 6     4  6    5 0.9104478           1</span>
<span class="co">#&gt; 7     4  7    5 1.0000000           1</span>
<span class="co">#&gt; 8     5  8    6 0.9452736           1</span>
<span class="co">#&gt; 9     6  9    6 0.8955224           1</span>
<span class="co">#&gt; 10    6 10    7 0.9950249           1</span>
<span class="co">#&gt; 11    4 11    7 0.6815920           2</span>
<span class="co">#&gt; 12    5 12    7 0.8706468           2</span>
<span class="co">#&gt; 13    9 13    7 1.0000000           2</span>
<span class="co">#&gt; 14    5 14    8 0.8358209           2</span>
<span class="co">#&gt; 15    5 15    8 0.8457711           2</span>
<span class="co">#&gt; 16    4 16    8 0.5671642           2</span>
<span class="co">#&gt; 17    4 17    7 0.8258706           2</span>
<span class="co">#&gt; 18    5 18    9 0.6119403           3</span>
<span class="co">#&gt; 19    9 19    9 0.9950249           3</span>
<span class="co">#&gt; 20   10 20   11 0.9950249           3</span>
<span class="co">#&gt; 21   11 21   10 0.9701493           2</span>
<span class="co">#&gt; 22   11 22   11 0.9900498           3</span>
<span class="co">#&gt; 23   13 23    9 1.0000000           3</span>
<span class="co">#&gt; 24   13 24   10 1.0000000           3</span>
<span class="co">#&gt; 25   13 25    9 1.0000000           3</span>
<span class="co">#&gt; 26   17 26    9 0.9452736           3</span>
<span class="co">#&gt; 27   17 27   11 0.9651741           3</span>
<span class="co">#&gt; 28   NA 28    9        NA          NA</span>
<span class="co">#&gt; 29   10 29   12 1.0000000           3</span>
<span class="co">#&gt; 30   13 30   12 0.9950249           3</span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="customising-settings-and-priors" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#customising-settings-and-priors" class="anchor"> </a></body></html>Customising settings and priors</h1>
<p>As said before, most customisation can be achieved via <code>create_config</code>. In the following, we make the following changes to the defaults:</p>
<ul>
<li><p>increase the number of iterations to 20,000</p></li>
<li><p>set the sampling rate to 20</p></li>
<li><p>use a star-like initial tree</p></li>
<li><p>disable to movement of <code>kappa</code>, so that we assume that all cases have observed</p></li>
<li><p>set a lower rate for the exponential prior of <code>mu</code> (10 instead of 1000)</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
config2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_config.html">create_config</a></span>(<span class="dt">n_iter =</span> <span class="fl">2e4</span>,
                        <span class="dt">sample_every =</span> <span class="dv">20</span>,
            <span class="dt">init_tree =</span><span class="st">"star"</span>,
            <span class="dt">move_kappa =</span> <span class="ot">FALSE</span>,
            <span class="dt">prior_mu =</span> <span class="dv">10</span>)

<span class="kw">set.seed</span>(<span class="dv">1</span>)

res2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/outbreaker.html">outbreaker</a></span>(data, config2)
<span class="kw">plot</span>(res2)</code></pre></div>
<p><img src="figs-introduction/config2-1.png" width="768"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(res2, <span class="dt">burnin =</span> <span class="dv">2000</span>)</code></pre></div>
<p><img src="figs-introduction/config2-2.png" width="768"></p>
<p>We can see that the burnin is around 3,000 iterations (i.e. after the initial step corresponding to a local optimum). We get the consensus tree from the new results, and compare the inferred tree to the actual ancestries stored in the dataset (<code>fake_outbreak$ances</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">summary</span>(res2, <span class="dt">burnin =</span> <span class="dv">4000</span>)
<span class="co">#&gt; $step</span>
<span class="co">#&gt;    first     last interval  n_steps </span>
<span class="co">#&gt;     4020    20000       20      800 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $post</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  -447.9  -435.8  -433.4  -433.7  -431.1  -424.9 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $like</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  -452.4  -440.1  -437.8  -438.1  -435.6  -429.5 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $prior</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   3.012   4.250   4.432   4.360   4.535   4.603 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mu</span>
<span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span>
<span class="co">#&gt; 8.155e-05 1.232e-04 1.362e-04 1.369e-04 1.519e-04 2.111e-04 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pi</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  0.8379  0.9614  0.9811  0.9736  0.9924  0.9999 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tree</span>
<span class="co">#&gt;    from to time support generations</span>
<span class="co">#&gt; 1    NA  1   -1      NA          NA</span>
<span class="co">#&gt; 2     1  2    1 1.00000           1</span>
<span class="co">#&gt; 3     2  3    3 0.99375           1</span>
<span class="co">#&gt; 4    NA  4    3      NA          NA</span>
<span class="co">#&gt; 5     3  5    4 0.99000           1</span>
<span class="co">#&gt; 6     4  6    5 0.97625           1</span>
<span class="co">#&gt; 7     4  7    5 1.00000           1</span>
<span class="co">#&gt; 8     5  8    6 0.96000           1</span>
<span class="co">#&gt; 9     6  9    6 1.00000           1</span>
<span class="co">#&gt; 10    6 10    7 1.00000           1</span>
<span class="co">#&gt; 11    7 11    7 0.66375           1</span>
<span class="co">#&gt; 12    5 12    7 0.83875           1</span>
<span class="co">#&gt; 13    9 13    7 1.00000           1</span>
<span class="co">#&gt; 14    5 14    7 0.74250           1</span>
<span class="co">#&gt; 15    5 15    7 0.71750           1</span>
<span class="co">#&gt; 16    7 16    8 0.81500           1</span>
<span class="co">#&gt; 17    7 17    7 0.61875           1</span>
<span class="co">#&gt; 18    8 18    9 0.42500           1</span>
<span class="co">#&gt; 19    9 19    9 1.00000           1</span>
<span class="co">#&gt; 20   10 20   10 0.96375           1</span>
<span class="co">#&gt; 21   11 21   10 0.96500           1</span>
<span class="co">#&gt; 22   11 22   10 1.00000           1</span>
<span class="co">#&gt; 23   13 23    9 1.00000           1</span>
<span class="co">#&gt; 24   13 24   10 1.00000           1</span>
<span class="co">#&gt; 25   13 25    9 1.00000           1</span>
<span class="co">#&gt; 26   17 26    9 1.00000           1</span>
<span class="co">#&gt; 27   17 27   10 1.00000           1</span>
<span class="co">#&gt; 28   NA 28    9      NA          NA</span>
<span class="co">#&gt; 29   10 29   11 1.00000           1</span>
<span class="co">#&gt; 30   13 30   11 1.00000           1</span>
tree2 &lt;-<span class="st"> </span><span class="kw">summary</span>(res2, <span class="dt">burnin =</span> <span class="dv">4000</span>)$tree

comparison &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">case =</span> <span class="dv">1</span>:<span class="dv">30</span>,
                         <span class="dt">inferred =</span> <span class="kw">paste</span>(tree2$from),
             <span class="dt">true =</span> <span class="kw">paste</span>(fake_outbreak$ances),
             <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
             
comparison$correct &lt;-<span class="st"> </span>comparison$inferred ==<span class="st"> </span>comparison$true
comparison
<span class="co">#&gt;    case inferred true correct</span>
<span class="co">#&gt; 1     1       NA   NA    TRUE</span>
<span class="co">#&gt; 2     2        1    1    TRUE</span>
<span class="co">#&gt; 3     3        2    2    TRUE</span>
<span class="co">#&gt; 4     4       NA   NA    TRUE</span>
<span class="co">#&gt; 5     5        3    3    TRUE</span>
<span class="co">#&gt; 6     6        4    4    TRUE</span>
<span class="co">#&gt; 7     7        4    4    TRUE</span>
<span class="co">#&gt; 8     8        5    5    TRUE</span>
<span class="co">#&gt; 9     9        6    6    TRUE</span>
<span class="co">#&gt; 10   10        6    6    TRUE</span>
<span class="co">#&gt; 11   11        7    7    TRUE</span>
<span class="co">#&gt; 12   12        5    8   FALSE</span>
<span class="co">#&gt; 13   13        9    9    TRUE</span>
<span class="co">#&gt; 14   14        5    5    TRUE</span>
<span class="co">#&gt; 15   15        5    5    TRUE</span>
<span class="co">#&gt; 16   16        7    7    TRUE</span>
<span class="co">#&gt; 17   17        7    7    TRUE</span>
<span class="co">#&gt; 18   18        8    8    TRUE</span>
<span class="co">#&gt; 19   19        9    9    TRUE</span>
<span class="co">#&gt; 20   20       10   10    TRUE</span>
<span class="co">#&gt; 21   21       11   11    TRUE</span>
<span class="co">#&gt; 22   22       11   11    TRUE</span>
<span class="co">#&gt; 23   23       13   13    TRUE</span>
<span class="co">#&gt; 24   24       13   13    TRUE</span>
<span class="co">#&gt; 25   25       13   13    TRUE</span>
<span class="co">#&gt; 26   26       17   17    TRUE</span>
<span class="co">#&gt; 27   27       17   17    TRUE</span>
<span class="co">#&gt; 28   28       NA   NA    TRUE</span>
<span class="co">#&gt; 29   29       10   10    TRUE</span>
<span class="co">#&gt; 30   30       13   13    TRUE</span>
<span class="kw">mean</span>(comparison$correct)
<span class="co">#&gt; [1] 0.9666667</span></code></pre></div>
<p>Let’s visualise the posterior trees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot</span>(res2, <span class="dt">type =</span> <span class="st">"network"</span>, <span class="dt">burnin =</span> <span class="dv">4000</span>, <span class="dt">min_support =</span> <span class="fl">0.01</span>)</code></pre></div>
<div id="htmlwidget-5e7fdcc20f14214870ea" style="width:768px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-5e7fdcc20f14214870ea">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"label":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"value":[1.00625,0.995,1,2.87875,3.46875,2,2.12125,0.97375,2,1.96375,1.965,0.5525,4,0,0,0,2,0.00375,0,0,0,0.035,0,0,0,0,0,0,0.03625,0],"color":["#CCDDFF","#B2D9E3","#98D6C7","#7ED2AC","#99CAA9","#C2C0AD","#ECB7B1","#EFB0B5","#D3ABB9","#B6A7BE","#ADA8AD","#C9B471","#E5C035","#FFCA04","#FFBC2C","#FFAE53","#FFA07B","#F0B986","#E1D78E","#D1F596","#CFEBA0","#D5CDAC","#DBAFB8","#E3A5B9","#EDB3AD","#F7C1A2","#FBCC9C","#ECCCAC","#DCCCBC","#CDCDCD"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"shaped":["star",null,null,"star",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"star",null,null]},"edges":{"from":[1,2,3,4,4,4,4,4,5,5,5,5,5,6,6,7,7,7,7,8,8,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,17,17,22,29],"to":[2,3,5,6,7,11,16,17,8,12,14,15,18,9,10,6,11,16,17,12,14,15,18,13,19,20,29,21,22,8,14,15,18,23,24,25,30,26,27,21,20],"value":[1,0.99375,0.99,0.97625,1,0.33625,0.185,0.38125,0.96,0.83875,0.7425,0.7175,0.21,1,1,0.02375,0.66375,0.815,0.61875,0.16,0.19125,0.18875,0.425,1,1,0.96375,1,0.965,1,0.03,0.06625,0.09125,0.365,1,1,1,1,1,1,0.035,0.03625],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"],"color":["#CCDDFF","#B2D9E3","#98D6C7","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#7ED2AC","#99CAA9","#99CAA9","#99CAA9","#99CAA9","#99CAA9","#C2C0AD","#C2C0AD","#ECB7B1","#ECB7B1","#ECB7B1","#ECB7B1","#EFB0B5","#EFB0B5","#EFB0B5","#EFB0B5","#D3ABB9","#D3ABB9","#B6A7BE","#B6A7BE","#ADA8AD","#ADA8AD","#C9B471","#C9B471","#C9B471","#C9B471","#E5C035","#E5C035","#E5C035","#E5C035","#FFA07B","#FFA07B","#D5CDAC","#DCCCBC"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","color":{"highlight":"red"},"shadow":{"enabled":true,"size":10}},"manipulation":{"enabled":false},"edges":{"arrows":{"to":{"enabled":true,"scaleFactor":0.2}},"color":{"highlight":"red"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null},"evals":[],"jsHooks":[]}</script>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#running-the-analysis-with-defaults">Running the analysis with defaults</a></li>
      <li>
<a href="#analysing-the-results">Analysing the results</a><ul class="nav nav-pills nav-stacked">
<li><a href="#graphics">Graphics</a></li>
      <li><a href="#using-summary">Using <code>summary</code></a></li>
      </ul>
</li>
      <li><a href="#customising-settings-and-priors">Customising settings and priors</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Finlay Campbell, Rich Fitzjohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
